<!DOCTYPE html>
<html>
<head>
    <title>Scrub</title>
    <meta charset="utf-8">
    <style type="text/css">
        body {
            width: 1400px;
            margin: 0 auto;
            text-align: center;

            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            user-select: none;
        }

        h1 {
            font-family: sans-serif;
            font-size: 128px;
            margin: 0;
        }

        p {
            font-size: 128px;
            margin: 0;
        }

        .slider-canvas {
            border-radius: 100px;
            cursor: pointer;
            border: 3px solid var(--slider-color);
        }
    </style>
</head>
<body>
    <h1>Scrub</h1>
    <video preload="auto">
        <source src="chili.mp4" type="video/mp4">
        <p>Doesn't work on your browser :(</p>
    </video>
    <video preload="auto">
        <source src="purple.mp4" type="video/mp4">
        <p>Doesn't work on your browser :(</p>
    </video>
    <p>
        ðŸ¥€ <span id="slider"></span> ðŸŒ¹
    </p>
    <script>
        function SpringSlider({walls = true, min = 0, max = 1, output = null, value = 0.5, width = 800, height = 100, padding = 10, color = '#333', acceleration = 0.05, elastic = 0.8} = {}){

            // Take a number range and output another
            function map(x, inMin, inMax, outMin, outMax) {
              return (x - inMin) * (outMax - outMin) / (inMax - inMin) + outMin
            }

            // Set up elements and size them

            const canvas = document.createElement('canvas')
            const ctx = canvas.getContext('2d')
            canvas.width = width
            canvas.height = height
            canvas.className = 'slider-canvas'
            canvas.style.setProperty('--slider-color', color)

            const radius = canvas.height / 2 - padding

            // Drawing
            let targetValue = value

            function draw(){
                ctx.clearRect(0, 0, canvas.width, canvas.height)

                ctx.fillStyle = color
                ctx.strokeStyle = ctx.fillStyle
                ctx.lineCap = 'round'

                ctx.lineWidth = 5

                ctx.beginPath()
                ctx.arc(map(value, 0, 1, radius + padding, canvas.width - radius - padding), canvas.height / 2, radius, 0, 2 * Math.PI)
                ctx.fill()

                ctx.beginPath()
                ctx.moveTo(map(targetValue, 0, 1, radius + padding, canvas.width - radius - padding), 0)
                ctx.lineTo(map(targetValue, 0, 1, radius + padding, canvas.width - radius - padding), canvas.height)
                ctx.stroke()

                ctx.beginPath()
                ctx.moveTo(map(value, 0, 1, radius + padding, canvas.width - radius - padding), canvas.height / 2)
                ctx.lineTo(map(targetValue, 0, 1, radius + padding, canvas.width - radius - padding), canvas.height / 2)
                ctx.stroke()
            }

            // Interaction

            let dragging = false

            function updateFromEvent(event){
                if(!dragging) return
                const rect = canvas.getBoundingClientRect()
                let x = (event.clientX - rect.left ) * (canvas.width / canvas.clientWidth)
                if(x < padding + radius) x = padding + radius
                if(x > canvas.width - padding - radius) x = canvas.width - padding - radius
                targetValue = map(x, padding + radius, canvas.width - padding - radius, 0, 1)
            }

            canvas.addEventListener('mousedown', event => {
                dragging = true
                updateFromEvent(event)
            })
            canvas.addEventListener('mouseup', () => dragging = false)
            canvas.addEventListener('mousemove', event => {
                if(event.buttons === 1) {
                    updateFromEvent(event)
                }
            })

            // Smooth values and ad velocity

            let valV = 0

            function loop(){
                valV += (targetValue - value) * acceleration
                value += valV
                valV *= elastic
                if(walls){
                    if(value <= 0) {
                        value = 0
                        valV *= -1
                    }
                    if(value >= 1) {
                        value = 1
                        valV *= -1
                    }
                }
                draw()
                if(output){
                    output(map(value, 0, 1, min, max))
                }
                requestAnimationFrame(loop)
            }

            loop()

            return canvas

        }

        var slider = SpringSlider({
            color: '#373',
            value: 0,
            output: value => {
                var videos = document.querySelectorAll("video");
                for (let video of videos) {
                    if (!isNaN(video.duration)){
                        if (typeof(videos[0].fastSeek) === "functionBLARHG") {
                            video.fastSeek(value * video.duration);
                        }
                        else {
                            video.currentTime = value * video.duration;
                        }
                    }
                };
            }
        })
        document.querySelector('#slider').appendChild(slider);
    </script>
</body>
</html>